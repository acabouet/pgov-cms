---
version: 1
default_config: &defaults
  buildpacks:
    - https://github.com/cloudfoundry/apt-buildpack
    - php_buildpack
  disk_quota: 2G
  env:
    COMPOSER_NO_DEV: false
    environment: dev
    LD_LIBRARY_PATH: /home/vcap/app/php/lib/
    no_proxy: true
    PHP_INI_SCAN_DIR: /home/vcap/app/php/etc/:/home/vcap/app/php/etc/php.ini.d/
  timeout: 180
  routes:
    - route: pgov-drupal-dev.apps.internal
      protocol: http2
#  services:
#    - pgov-mysql-dev
#    - pgov-secrets-dev
#    - pgov-static-dev
#    - pgov-storage-dev

applications:
  - name: PGOV-CMS
    <<: *defaults
    memory: 2048M
    stack: cflinuxfs4
    instances: 2
    random-route: false
    path: ./
  - name: PGOV-Frontend
    path: ./src/frontend
    buildpacks:
      - nodejs_buildpack
    routes:
      - route: pgov-frontend-dev.apps.internal
        protocol: http2
